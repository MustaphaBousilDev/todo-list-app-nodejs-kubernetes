version: "3.9"

services:
  app:
    container_name: node-app
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "4000:4000"
    environment:
      NODE_ENV: production
      PORT: 4000
    restart: unless-stopped
    healthcheck:
      test: >
        node -e "require('http').get('http://localhost:4000/health',
        r => process.exit(r.statusCode === 200 ? 0 : 1))
        .on('error', () => process.exit(1))"
      interval: 30s
      timeout: 5s
      retries: 3
